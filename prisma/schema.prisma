generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Multi-tenancy
model Organization {
  id         String   @id @default(uuid())
  clerkOrgId String   @unique @map("clerk_org_id")
  name       String
  slug       String   @unique
  plan       String   @default("free")
  maxUsers   Int      @default(5) @map("max_users")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  users                       User[]
  members                     Member[]
  departments                 Department[]
  grievances                  Grievance[]
  contracts                   Contract[]
  stepTemplates               StepTemplate[]
  customFields                CustomField[]
  pdfTemplates                PdfTemplate[]
  emailTemplates              EmailTemplate[]
  systemSettings              SystemSetting[]
  textSnippets                TextSnippet[]
  emailCampaigns              EmailCampaign[]
  disciplinaryCases           DisciplinaryCase[]
  disciplinaryStepTemplates   DisciplinaryStepTemplate[]
  disciplinarySnippets        DisciplinarySnippet[]

  @@map("organizations")
}

model User {
  id             String   @id @default(uuid())
  clerkUserId    String   @map("clerk_user_id")
  email          String
  name           String
  role           UserRole @default(REPRESENTATIVE)
  organizationId String   @map("organization_id")
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization                  Organization          @relation(fields: [organizationId], references: [id])
  assignedGrievances            Grievance[]           @relation("AssignedRepresentative")
  createdGrievances             Grievance[]           @relation("CreatedBy")
  grievanceNotes                GrievanceNote[]
  grievanceMessages             GrievanceMessage[]
  memberNotes                   MemberNote[]
  notifications                 UserNotification[]
  auditLogs                     AuditLog[]
  completedSteps                GrievanceStep[]       @relation("StepCompletedBy")
  createdCampaigns              EmailCampaign[]
  assignedDisciplinaryCases     DisciplinaryCase[]    @relation("DisciplinaryRepresentative")
  createdDisciplinaryCases      DisciplinaryCase[]    @relation("DisciplinaryCreatedBy")
  disciplinaryNotes             DisciplinaryNote[]
  disciplinaryMessages          DisciplinaryMessage[]
  completedDisciplinarySteps    DisciplinaryStep[]    @relation("DisciplinaryStepCompletedBy")

  @@unique([clerkUserId, organizationId])
  @@unique([email, organizationId])
  @@map("users")
}

enum UserRole {
  ADMIN
  REPRESENTATIVE
  VIEWER
}

model Member {
  id              String           @id @default(uuid())
  organizationId  String           @map("organization_id")
  memberId        String?          @map("member_id")
  firstName       String           @map("first_name")
  lastName        String           @map("last_name")
  email           String?
  homePhone       String?          @map("home_phone")
  cellPhone       String?          @map("cell_phone")
  address         String?
  city            String?
  state           String?
  zipCode         String?          @map("zip_code")
  dateOfBirth     DateTime?        @map("date_of_birth")
  hireDate        DateTime?        @map("hire_date")
  jobTitle        String?          @map("job_title")
  workLocation    String?          @map("work_location")
  departmentId    String?          @map("department_id")
  status          MemberStatus     @default(MEMBER)
  employmentType  EmploymentType?  @map("employment_type")
  customFields    Json?            @map("custom_fields")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  organization        Organization        @relation(fields: [organizationId], references: [id])
  department          Department?         @relation(fields: [departmentId], references: [id])
  grievances          Grievance[]
  notes               MemberNote[]
  documents           MemberDocument[]
  campaignEmails      CampaignEmail[]
  disciplinaryCases   DisciplinaryCase[]

  @@index([organizationId, lastName, firstName])
  @@index([organizationId, status])
  @@index([organizationId, departmentId])
  @@map("members")
}

enum MemberStatus {
  MEMBER
  NON_MEMBER
  SEVERED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  TEMPORARY
  SEASONAL
}

model Grievance {
  id                  String          @id @default(uuid())
  organizationId      String          @map("organization_id")
  grievanceNumber     String          @map("grievance_number")
  memberId            String?         @map("member_id")
  representativeId    String?         @map("representative_id")
  createdById         String          @map("created_by_id")
  departmentId        String?         @map("department_id")
  description         String
  reliefRequested     String?         @map("relief_requested")
  memberJobTitle      String?         @map("member_job_title")
  commissionerName    String?         @map("commissioner_name")
  status              GrievanceStatus @default(OPEN)
  priority            Priority        @default(MEDIUM)
  outcome             GrievanceOutcome?
  outcomeNotes        String?         @map("outcome_notes")
  settlementAmount    Decimal?        @map("settlement_amount") @db.Decimal(10, 2)
  filingDate          DateTime        @default(now()) @map("filing_date")
  customFields        Json?           @map("custom_fields")
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @updatedAt @map("updated_at")

  organization        Organization            @relation(fields: [organizationId], references: [id])
  member              Member?                 @relation(fields: [memberId], references: [id])
  representative      User?                   @relation("AssignedRepresentative", fields: [representativeId], references: [id])
  createdBy           User                    @relation("CreatedBy", fields: [createdById], references: [id])
  department          Department?             @relation(fields: [departmentId], references: [id])
  steps               GrievanceStep[]
  notes               GrievanceNote[]
  messages            GrievanceMessage[]
  documents           Document[]
  contractViolations  GrievanceContractViolation[]
  relatedFrom         GrievanceRelation[]     @relation("RelatedFrom")
  relatedTo           GrievanceRelation[]     @relation("RelatedTo")

  @@unique([grievanceNumber, organizationId])
  @@index([organizationId, status])
  @@index([organizationId, priority])
  @@index([organizationId, createdAt])
  @@index([organizationId, departmentId])
  @@map("grievances")
}

enum GrievanceStatus {
  OPEN
  IN_PROGRESS
  PENDING_RESPONSE
  RESOLVED
  CLOSED
  WITHDRAWN
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum GrievanceOutcome {
  WON
  LOST
  SETTLED
  WITHDRAWN
  PENDING_ARBITRATION
}

// Disciplinary Enums
enum DisciplinaryStatus {
  OPEN
  IN_PROGRESS
  PENDING_REVIEW
  RESOLVED
  CLOSED
}

enum DisciplinaryOutcome {
  NO_ACTION
  VERBAL_WARNING
  WRITTEN_WARNING
  SUSPENSION
  TERMINATION
  OTHER
}

enum DisciplinaryType {
  ATTENDANCE
  PERFORMANCE
  CONDUCT
  POLICY_VIOLATION
  SAFETY
  OTHER
}

enum DisciplinarySnippetCategory {
  INVESTIGATION
  INTERVIEW
  RESOLUTION
  GENERAL
}

model GrievanceStep {
  id            String      @id @default(uuid())
  grievanceId   String      @map("grievance_id")
  stepNumber    Int         @map("step_number")
  name          String
  description   String?
  deadline      DateTime?
  completedAt   DateTime?   @map("completed_at")
  completedById String?     @map("completed_by_id")
  status        StepStatus  @default(PENDING)
  notes         String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  grievance     Grievance   @relation(fields: [grievanceId], references: [id], onDelete: Cascade)
  completedBy   User?       @relation("StepCompletedBy", fields: [completedById], references: [id])

  @@map("grievance_steps")
}

enum StepStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  OVERDUE
  SKIPPED
}

model StepTemplate {
  id                  String   @id @default(uuid())
  organizationId      String   @map("organization_id")
  stepNumber          Int      @map("step_number")
  name                String
  description         String?
  defaultDeadlineDays Int?     @map("default_deadline_days")
  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("step_templates")
}

model Department {
  id                String   @id @default(uuid())
  organizationId    String   @map("organization_id")
  name              String
  code              String?
  commissionerName  String?  @map("commissioner_name")
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  organization        Organization         @relation(fields: [organizationId], references: [id])
  members             Member[]
  grievances          Grievance[]
  disciplinaryCases   DisciplinaryCase[]

  @@unique([name, organizationId])
  @@map("departments")
}

model GrievanceNote {
  id            String   @id @default(uuid())
  grievanceId   String   @map("grievance_id")
  userId        String   @map("user_id")
  content       String
  isInternal    Boolean  @default(false) @map("is_internal")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  grievance     Grievance @relation(fields: [grievanceId], references: [id], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [id])

  @@map("grievance_notes")
}

model GrievanceMessage {
  id            String   @id @default(uuid())
  grievanceId   String   @map("grievance_id")
  userId        String   @map("user_id")
  parentId      String?  @map("parent_id")
  content       String
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  grievance     Grievance          @relation(fields: [grievanceId], references: [id], onDelete: Cascade)
  user          User               @relation(fields: [userId], references: [id])
  parent        GrievanceMessage?  @relation("Replies", fields: [parentId], references: [id])
  replies       GrievanceMessage[] @relation("Replies")
  readBy        MessageRead[]

  @@map("grievance_messages")
}

model MessageRead {
  id        String   @id @default(uuid())
  messageId String   @map("message_id")
  userId    String   @map("user_id")
  readAt    DateTime @default(now()) @map("read_at")

  message   GrievanceMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_reads")
}

model MemberNote {
  id        String   @id @default(uuid())
  memberId  String   @map("member_id")
  userId    String   @map("user_id")
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  member    Member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  user      User   @relation(fields: [userId], references: [id])

  @@map("member_notes")
}

model MemberDocument {
  id          String   @id @default(uuid())
  memberId    String   @map("member_id")
  fileName    String   @map("file_name")
  fileType    String   @map("file_type")
  fileSize    Int      @map("file_size")
  storagePath String   @map("storage_path")
  uploadedAt  DateTime @default(now()) @map("uploaded_at")

  member      Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@map("member_documents")
}

model Document {
  id          String   @id @default(uuid())
  grievanceId String   @map("grievance_id")
  fileName    String   @map("file_name")
  fileType    String   @map("file_type")
  fileSize    Int      @map("file_size")
  storagePath String   @map("storage_path")
  uploadedAt  DateTime @default(now()) @map("uploaded_at")

  grievance   Grievance @relation(fields: [grievanceId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model Contract {
  id              String   @id @default(uuid())
  organizationId  String   @map("organization_id")
  name            String
  effectiveDate   DateTime @map("effective_date")
  expirationDate  DateTime @map("expiration_date")
  fileUrl         String?  @map("file_url")
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  organization    Organization      @relation(fields: [organizationId], references: [id])
  articles        ContractArticle[]

  @@map("contracts")
}

model ContractArticle {
  id            String   @id @default(uuid())
  contractId    String   @map("contract_id")
  articleNumber String   @map("article_number")
  title         String
  content       String
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  contract                Contract                          @relation(fields: [contractId], references: [id], onDelete: Cascade)
  violations              GrievanceContractViolation[]
  disciplinaryViolations  DisciplinaryContractViolation[]

  @@map("contract_articles")
}

model GrievanceContractViolation {
  id                String   @id @default(uuid())
  grievanceId       String   @map("grievance_id")
  contractArticleId String   @map("contract_article_id")
  notes             String?
  createdAt         DateTime @default(now()) @map("created_at")

  grievance         Grievance       @relation(fields: [grievanceId], references: [id], onDelete: Cascade)
  contractArticle   ContractArticle @relation(fields: [contractArticleId], references: [id])

  @@unique([grievanceId, contractArticleId])
  @@map("grievance_contract_violations")
}

model GrievanceRelation {
  id              String   @id @default(uuid())
  grievanceId     String   @map("grievance_id")
  relatedId       String   @map("related_id")
  relationType    String   @map("relation_type")
  createdAt       DateTime @default(now()) @map("created_at")

  grievance       Grievance @relation("RelatedFrom", fields: [grievanceId], references: [id], onDelete: Cascade)
  related         Grievance @relation("RelatedTo", fields: [relatedId], references: [id], onDelete: Cascade)

  @@unique([grievanceId, relatedId])
  @@map("grievance_relations")
}

model CustomField {
  id              String        @id @default(uuid())
  organizationId  String        @map("organization_id")
  entityType      EntityType    @map("entity_type")
  fieldName       String        @map("field_name")
  fieldLabel      String        @map("field_label")
  fieldType       FieldType     @map("field_type")
  options         Json?
  isRequired      Boolean       @default(false) @map("is_required")
  displayOrder    Int           @default(0) @map("display_order")
  isActive        Boolean       @default(true) @map("is_active")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@unique([fieldName, entityType, organizationId])
  @@map("custom_fields")
}

enum EntityType {
  GRIEVANCE
  MEMBER
}

enum FieldType {
  TEXT
  NUMBER
  DATE
  SELECT
  CHECKBOX
  TEXTAREA
}

model PdfTemplate {
  id              String   @id @default(uuid())
  organizationId  String   @map("organization_id")
  name            String
  description     String?
  content         String
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("pdf_templates")
}

model EmailTemplate {
  id              String                @id @default(uuid())
  organizationId  String                @map("organization_id")
  name            String
  subject         String
  body            String
  category        EmailTemplateCategory
  isActive        Boolean               @default(true) @map("is_active")
  createdAt       DateTime              @default(now()) @map("created_at")
  updatedAt       DateTime              @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])
  campaigns       EmailCampaign[]

  @@map("email_templates")
}

enum EmailTemplateCategory {
  MEMBER_NOTIFICATION
  MANAGEMENT
  INTERNAL
}

model SystemSetting {
  id              String   @id @default(uuid())
  organizationId  String   @map("organization_id")
  key             String
  value           String
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@unique([key, organizationId])
  @@map("system_settings")
}

model TextSnippet {
  id              String        @id @default(uuid())
  organizationId  String        @map("organization_id")
  name            String
  content         String
  category        SnippetCategory
  isActive        Boolean       @default(true) @map("is_active")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("text_snippets")
}

enum SnippetCategory {
  DESCRIPTION
  RELIEF_REQUESTED
}

model AuditLog {
  id          String      @id @default(uuid())
  entityType  String      @map("entity_type")
  entityId    String      @map("entity_id")
  action      AuditAction
  userId      String      @map("user_id")
  changes     Json
  createdAt   DateTime    @default(now()) @map("created_at")

  user        User @relation(fields: [userId], references: [id])

  @@index([entityType, entityId])
  @@map("audit_logs")
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
}

model UserNotification {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  type        String
  title       String
  message     String
  linkUrl     String?  @map("link_url")
  isRead      Boolean  @default(false) @map("is_read")
  createdAt   DateTime @default(now()) @map("created_at")

  user        User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_notifications")
}

// Email Campaign
model EmailCampaign {
  id              String           @id @default(uuid())
  organizationId  String           @map("organization_id")
  name            String
  subject         String
  body            String
  templateId      String?          @map("template_id")
  status          CampaignStatus   @default(DRAFT)

  // Targeting: { departments: [], statuses: [], employmentTypes: [] }
  targetCriteria  Json?            @map("target_criteria")

  // Throttling
  emailsPerMinute Int              @default(50) @map("emails_per_minute")

  // Timestamps
  scheduledAt     DateTime?        @map("scheduled_at")
  startedAt       DateTime?        @map("started_at")
  pausedAt        DateTime?        @map("paused_at")
  completedAt     DateTime?        @map("completed_at")

  // Stats (denormalized)
  totalRecipients Int              @default(0) @map("total_recipients")
  sentCount       Int              @default(0) @map("sent_count")
  failedCount     Int              @default(0) @map("failed_count")

  // Tracking stats (denormalized)
  uniqueOpens     Int              @default(0) @map("unique_opens")
  uniqueClicks    Int              @default(0) @map("unique_clicks")
  totalOpens      Int              @default(0) @map("total_opens")
  totalClicks     Int              @default(0) @map("total_clicks")

  createdById     String           @map("created_by_id")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  organization    Organization     @relation(fields: [organizationId], references: [id])
  template        EmailTemplate?   @relation(fields: [templateId], references: [id])
  createdBy       User             @relation(fields: [createdById], references: [id])
  emails          CampaignEmail[]

  @@index([organizationId, status])
  @@map("email_campaigns")
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  PAUSED
  COMPLETED
  CANCELLED
}

// Individual queued emails
model CampaignEmail {
  id              String       @id @default(uuid())
  campaignId      String       @map("campaign_id")
  memberId        String       @map("member_id")
  recipientEmail  String       @map("recipient_email")
  recipientName   String       @map("recipient_name")
  status          EmailStatus  @default(PENDING)
  sentAt          DateTime?    @map("sent_at")
  errorMessage    String?      @map("error_message")
  retryCount      Int          @default(0) @map("retry_count")

  // Tracking stats (denormalized for performance)
  openCount       Int          @default(0) @map("open_count")
  clickCount      Int          @default(0) @map("click_count")
  firstOpenedAt   DateTime?    @map("first_opened_at")
  lastOpenedAt    DateTime?    @map("last_opened_at")

  createdAt       DateTime     @default(now()) @map("created_at")

  campaign        EmailCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  member          Member        @relation(fields: [memberId], references: [id])
  opens           EmailOpen[]
  clicks          EmailClick[]

  @@index([campaignId, status])
  @@map("campaign_emails")
}

enum EmailStatus {
  PENDING
  SENDING
  SENT
  FAILED
  SKIPPED
}

// Email open tracking
model EmailOpen {
  id              String        @id @default(uuid())
  emailId         String        @map("email_id")
  openedAt        DateTime      @default(now()) @map("opened_at")
  userAgent       String?       @map("user_agent")
  ipAddress       String?       @map("ip_address")

  email           CampaignEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@map("email_opens")
}

// Email click tracking
model EmailClick {
  id              String        @id @default(uuid())
  emailId         String        @map("email_id")
  url             String
  clickedAt       DateTime      @default(now()) @map("clicked_at")
  userAgent       String?       @map("user_agent")
  ipAddress       String?       @map("ip_address")

  email           CampaignEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@map("email_clicks")
}

// ============================================
// DISCIPLINARY SYSTEM MODELS
// ============================================

model DisciplinaryStepTemplate {
  id                  String   @id @default(uuid())
  organizationId      String   @map("organization_id")
  stepNumber          Int      @map("step_number")
  name                String
  description         String?
  defaultDeadlineDays Int?     @map("default_deadline_days")
  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("disciplinary_step_templates")
}

model DisciplinaryCase {
  id                  String              @id @default(uuid())
  organizationId      String              @map("organization_id")
  caseNumber          String              @map("case_number")
  memberId            String?             @map("member_id")
  representativeId    String?             @map("representative_id")
  createdById         String              @map("created_by_id")
  departmentId        String?             @map("department_id")
  type                DisciplinaryType    @default(OTHER)
  description         String
  incidentDate        DateTime?           @map("incident_date")
  memberJobTitle      String?             @map("member_job_title")
  supervisorName      String?             @map("supervisor_name")
  status              DisciplinaryStatus  @default(OPEN)
  priority            Priority            @default(MEDIUM)
  outcome             DisciplinaryOutcome?
  outcomeNotes        String?             @map("outcome_notes")
  filingDate          DateTime            @default(now()) @map("filing_date")
  customFields        Json?               @map("custom_fields")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")

  organization        Organization                    @relation(fields: [organizationId], references: [id])
  member              Member?                         @relation(fields: [memberId], references: [id])
  representative      User?                           @relation("DisciplinaryRepresentative", fields: [representativeId], references: [id])
  createdBy           User                            @relation("DisciplinaryCreatedBy", fields: [createdById], references: [id])
  department          Department?                     @relation(fields: [departmentId], references: [id])
  steps               DisciplinaryStep[]
  notes               DisciplinaryNote[]
  messages            DisciplinaryMessage[]
  documents           DisciplinaryDocument[]
  contractViolations  DisciplinaryContractViolation[]

  @@unique([caseNumber, organizationId])
  @@index([organizationId, status])
  @@index([organizationId, priority])
  @@index([organizationId, createdAt])
  @@index([organizationId, departmentId])
  @@map("disciplinary_cases")
}

model DisciplinaryStep {
  id            String      @id @default(uuid())
  caseId        String      @map("case_id")
  stepNumber    Int         @map("step_number")
  name          String
  description   String?
  deadline      DateTime?
  completedAt   DateTime?   @map("completed_at")
  completedById String?     @map("completed_by_id")
  status        StepStatus  @default(PENDING)
  notes         String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  case          DisciplinaryCase @relation(fields: [caseId], references: [id], onDelete: Cascade)
  completedBy   User?            @relation("DisciplinaryStepCompletedBy", fields: [completedById], references: [id])

  @@map("disciplinary_steps")
}

model DisciplinaryNote {
  id            String   @id @default(uuid())
  caseId        String   @map("case_id")
  userId        String   @map("user_id")
  content       String
  isInternal    Boolean  @default(false) @map("is_internal")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  case          DisciplinaryCase @relation(fields: [caseId], references: [id], onDelete: Cascade)
  user          User             @relation(fields: [userId], references: [id])

  @@map("disciplinary_notes")
}

model DisciplinaryMessage {
  id            String   @id @default(uuid())
  caseId        String   @map("case_id")
  userId        String   @map("user_id")
  parentId      String?  @map("parent_id")
  content       String
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  case          DisciplinaryCase       @relation(fields: [caseId], references: [id], onDelete: Cascade)
  user          User                   @relation(fields: [userId], references: [id])
  parent        DisciplinaryMessage?   @relation("DisciplinaryReplies", fields: [parentId], references: [id])
  replies       DisciplinaryMessage[]  @relation("DisciplinaryReplies")

  @@map("disciplinary_messages")
}

model DisciplinaryDocument {
  id          String   @id @default(uuid())
  caseId      String   @map("case_id")
  fileName    String   @map("file_name")
  fileType    String   @map("file_type")
  fileSize    Int      @map("file_size")
  storagePath String   @map("storage_path")
  uploadedAt  DateTime @default(now()) @map("uploaded_at")

  case        DisciplinaryCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@map("disciplinary_documents")
}

model DisciplinarySnippet {
  id              String                       @id @default(uuid())
  organizationId  String                       @map("organization_id")
  name            String
  content         String
  category        DisciplinarySnippetCategory
  isActive        Boolean                      @default(true) @map("is_active")
  createdAt       DateTime                     @default(now()) @map("created_at")
  updatedAt       DateTime                     @updatedAt @map("updated_at")

  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("disciplinary_snippets")
}

model DisciplinaryContractViolation {
  id                String   @id @default(uuid())
  caseId            String   @map("case_id")
  contractArticleId String   @map("contract_article_id")
  notes             String?
  createdAt         DateTime @default(now()) @map("created_at")

  case              DisciplinaryCase @relation(fields: [caseId], references: [id], onDelete: Cascade)
  contractArticle   ContractArticle  @relation(fields: [contractArticleId], references: [id])

  @@unique([caseId, contractArticleId])
  @@map("disciplinary_contract_violations")
}
